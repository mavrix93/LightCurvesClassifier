var JSONROOT="/_portaljs/";function fetchIntoMain(a,b,c){destEl=$("#mainbox");destEl.empty();ul=$('<ul class="servicelist"></ul>');destEl.append(ul);$.getJSON(a,c,function(a,c,e){a.map(function(a){ul.append(b(a))})})}function updateForInput(){(words=$("#textsearch").val())?fetchIntoMain(JSONROOT+"byFulltext",formatResourceHeader,{q:words}):($("#mainbox").empty(),$("#mainbox").append($("<ul class='servicelist'/>")))}function textsearchKey(a){13==a.which&&updateForInput($("#mainbox"))}
function makeMainFetcher(a,b){return function(){fetchIntoMain(a,b)}}function makeFormatter(a){return function(b){return renderTemplate(a,b)}}fetchTitles=makeMainFetcher(JSONROOT+"titles",formatResourceHeader);fetchSubjects=makeMainFetcher(JSONROOT+"subjects",makeFormatter("tmpl_subjectHeader"));fetchAuthors=makeMainFetcher(JSONROOT+"authors",makeFormatter("tmpl_authorHeader"));fetchFulltext=updateForInput;
function formatResourceHeader(a){return $(renderTemplate(a.browseable?"tmpl_resHead":"tmpl_resHeadNobrowse",a))}function formatResourceRecord(a,b){return renderTemplate("tmpl_resDetails",b)}function makeMatchAdder(a,b){return function(c){destElement=$("<ul class='servicelist fold'/>");c.parent().append(destElement);pars={};pars[b]=c.attr("value");$.getJSON(a,pars,function(a,b,c){a.map(function(a){destElement.append(formatResourceHeader(a))})})}}
function addServiceInfo(a){var b=a.attr("value").split(","),c=a.parent();$.getJSON(JSONROOT+"serviceInfo",{resId:b[1],sourceRD:b[0]},function(a,b,e){c.append(formatResourceRecord(c,a[0]))})}function _makeToggler(a){return function(b){b=$(b);var c=b.parent().find(".fold");if(0==c.length){a(b);var d=!1}else d="none"!=c.css("display");d?(b.find(".handlearrow").html("&#x25B6"),c.css("display","none")):(b.find(".handlearrow").html("&#x25BC"),c.css("display","block"))}}toggleDetails=_makeToggler(addServiceInfo);
toggleSubjectResources=_makeToggler(makeMatchAdder(JSONROOT+"bySubject","subject"));toggleAuthorResources=_makeToggler(makeMatchAdder(JSONROOT+"byAuthor","author"));$(document).ready(function(){$("#tab_placeholder").replaceWith($($.trim(document.getElementById("tabbar_store").innerHTML)));$("#tabset_tabs li").bind("click",makeTabCallback({"by-subject":fetchSubjects,"by-author":fetchAuthors,"by-title":fetchTitles,"by-text":fetchFulltext}));$("#textsearch").bind("keypress",textsearchKey)});